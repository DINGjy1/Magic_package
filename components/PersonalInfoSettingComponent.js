(wx["webpackJsonp"]=wx["webpackJsonp"]||[]).push([[7],{237:function(e,n){e.exports=function(e){if("string"!==typeof e)throw new TypeError("Expected input to be a string");if(e.length%2!==0)throw new RangeError("Expected string to be an even number of characters");for(var n=new Uint8Array(e.length/2),t=0;t<e.length;t+=2)n[t/2]=parseInt(e.substring(t,t+2),16);return n.buffer}},278:function(e,n,t){"use strict";t.r(n);var a,o,r,i=t(17),c=t(11),s=t(27),u=t(30),l=t(3),d=t.n(l),p=t(36),f=t(10),h=t.n(f),g=t(2),w=t(24),b=t(28),x=t.n(b),m=t(22),v=t(0),j=t(12),y=t(33),O=t(237),T=t.n(O),S=function(e){return h.a.arrayBufferToBase64(T()(e))},k=function(e,n,t){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=S(t);return new Promise((function(t,i){o&&h.a.showLoading({title:"",mask:!0});var u=function(){o&&h.a.hideLoading()},l=x()(a||(a=Object(s["a"])(['\n              mutation ImagePresignedUrl {\n                imagePresignedUrl(imgMd5Base64: "','", imageSuffix: ',") {\n                  uploadUrl\n                  downloadUrl\n                  contentType\n                  imageId\n                }\n              }\n            "])),r,n);m["a"].mutate({mutation:l,variables:{}},{onSuccess:function(){var n=Object(c["a"])(d.a.mark((function n(a){var o,c,s,l,p;return d.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:o=a.data.imagePresignedUrl,c=o.uploadUrl,s=o.downloadUrl,l=o.contentType,p=o.imageId,h.a.getFileSystemManager().readFile({filePath:e,success:function(e){h.a.request({url:c,timeout:18e4,header:{"Content-Type":l,"Content-MD5":r},method:"PUT",data:e.data,success:function(e){console.log(e),u(),t({id:p,url:s})},fail:function(e){console.log(e),u(),i(null),h.a.showToast({title:"".concat(e.errMsg),duration:1500,icon:"none"})}})},fail:function(e){console.log(e),u(),i(null),h.a.showToast({title:"".concat(e.errMsg),duration:1500,icon:"none"})}});case 2:case"end":return n.stop()}}),n)})));function a(e){return n.apply(this,arguments)}return a}(),onFailure:function(){var e=Object(c["a"])(d.a.mark((function e(){return d.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:u(),i(null);case 2:case"end":return e.stop()}}),e)})));function n(){return e.apply(this,arguments)}return n}(),onShowToast:function(e){h.a.showToast({title:"".concat(e),duration:1500,icon:"none"})}})}))},F=["CSS","DOC","DOCX","GIF","HTML","JPEG","JPG","JSON","MOV","MP3","MP4","OTHER","PDF","PNG","PPT","PPTX","TXT","WAV","XLS","XLSX","XML"],P=([].concat(F,Object(y["a"])(F.map((function(e){return e.toLowerCase()})))),t(23)),C=t(7),I=t(1),_=t(4),U="https://mmbiz.qpic.cn/mmbiz/icTdbqWNOwNRna42FI242Lcia07jQodd2FJGIYQfG0LAJGFxM4FbnQP6yfMxBgJ0F3YRqJCJ1aPAK2dQagdusBZg/0",E=function(){var e=Object(g["useState"])({url:U}),n=Object(u["a"])(e,2),t=n[0],a=n[1],i=Object(g["useState"])(void 0),l=Object(u["a"])(i,2),p=l[0],f=l[1],b=w["a"].getAccountId();Object(g["useEffect"])((function(){var e=x()(o||(o=Object(s["a"])(["\n          query GetUserInfo {\n            account( where: { _and: [ "," ] }   limit: 1){\n              __typename\n              id \n              profile_image {\n                id\n                url\n              }\n              username\n            }\n          }\n        "])),Object(j["b"])("id","_eq",b));m["a"].query({query:e,variables:{}},{onSuccess:function(){var e=Object(c["a"])(d.a.mark((function e(n){var t,o;return d.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t=n.data.account,t.length?(o=t[0],o.profile_image&&(o.profile_image.id&&o.profile_image.url?a(o.profile_image):h.a.showToast({title:"\u7528\u6237\u5934\u50cf\u6570\u636e\u9519\u8bef",duration:1500,icon:"none"})),o.username&&f(o.username)):h.a.showToast({title:"\u7528\u6237\u4fe1\u606f\u67e5\u8be2\u8bf7\u6c42\u7ed3\u679c\u9519\u8bef",duration:1500,icon:"none"});case 2:case"end":return e.stop()}}),e)})));function n(n){return e.apply(this,arguments)}return n}(),onFailure:function(){var e=Object(c["a"])(d.a.mark((function e(){return d.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:h.a.showToast({title:"\u7528\u6237\u4fe1\u606f\u67e5\u8be2\u8bf7\u6c42\u5931\u8d25",duration:1500,icon:"none"});case 1:case"end":return e.stop()}}),e)})));function n(){return e.apply(this,arguments)}return n}()})}),[]);var y=function(){var e=Object(c["a"])(d.a.mark((function e(n){var t,o,r,i,c,s,u,l;return d.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(h.a.showLoading(),null===(t=n.detail)||void 0===t||!t.avatarUrl||null===(o=n.detail)||void 0===o||!o.avatarUrl.length){e.next=12;break}return i=null===(r=n.detail)||void 0===r?void 0:r.avatarUrl,e.next=5,h.a.getFileInfo({filePath:i});case 5:return c=e.sent,s=i.substring(i.lastIndexOf(".")+1).toUpperCase(),u=k(i,s,c.digest,!1),e.next=10,u;case 10:l=e.sent,a({id:l.id,url:l.url});case 12:h.a.hideLoading();case 13:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),O=function(){if(t.id&&p){var e=x()(r||(r=Object(s["a"])(['\n            mutation UpdateUserInfo {\n              update_account(_set: { username: "','",\n              profile_image_id: '," }, where: { id: { _eq: "," } }) {\n                affected_rows\n                returning {\n                  id\n                }\n              }\n            }\n          "])),p,t.id,b);m["a"].mutate({mutation:e,variables:{}},{onSuccess:function(){var e=Object(c["a"])(d.a.mark((function e(){return d.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:C["a"].emit("navigation_go-back",!1),P["a"].onPersonalInfoSettingSuccess&&setTimeout(Object(c["a"])(d.a.mark((function e(){return d.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,P["a"].onPersonalInfoSettingSuccess();case 2:P["a"].onPersonalInfoSettingSuccess=null;case 3:case"end":return e.stop()}}),e)}))),100);case 2:case"end":return e.stop()}}),e)})));function n(){return e.apply(this,arguments)}return n}(),onFailure:function(){var e=Object(c["a"])(d.a.mark((function e(){return d.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:h.a.showToast({title:"\u4fee\u6539\u7528\u6237\u4fe1\u606f\u5931\u8d25",duration:1500,icon:"none"});case 1:case"end":return e.stop()}}),e)})));function n(){return e.apply(this,arguments)}return n}()})}else h.a.showToast({title:"\u8bf7\u586b\u5165\u5934\u50cf\u548c\u6635\u79f0",duration:1500,icon:"none"})},T=function(){C["a"].emit("navigation_go-back",!1)};return Object(_["jsxs"])(I["r"],{style:{position:"absolute",width:"100vw",height:"100vh",zIndex:"9999",backgroundColor:"white"},children:[Object(_["jsx"])(I["r"],{style:{width:"100%",padding:"".concat(32*v["a"].ratio,"px 0")},children:Object(_["jsx"])(I["a"],{openType:"chooseAvatar",onChooseAvatar:y,style:{width:"".concat(64*v["a"].ratio,"px"),height:"".concat(64*v["a"].ratio,"px"),padding:0},children:Object(_["jsx"])(I["d"],{src:t.url,style:{width:"100%",height:"100%"},mode:"scaleToFill"})})}),Object(_["jsxs"])(I["r"],{style:{width:"100%",padding:"".concat(8*v["a"].ratio,"px ").concat(48*v["a"].ratio,"px"),display:"flex",borderTop:"1px solid #E9E9E9",borderBottom:"1px solid #E9E9E9"},children:[Object(_["jsx"])(I["p"],{style:{width:"".concat(100*v["a"].ratio,"px"),fontSize:"".concat(14*v["a"].ratio)},children:"\u6635\u79f0"}),Object(_["jsx"])(I["e"],{style:{fontSize:"".concat(14*v["a"].ratio,"px")},type:"nickname",placeholder:"\u8bf7\u8f93\u5165\u6635\u79f0",value:p,onInput:function(e){return f(e.detail.value)}})]}),Object(_["jsxs"])(I["r"],{style:{width:"100%",marginTop:"".concat(48*v["a"].ratio,"px"),display:"flex",textAlign:"center",justifyContent:"space-between"},children:[Object(_["jsx"])(I["r"],{style:{width:"50%"},children:Object(_["jsx"])(I["a"],{style:{width:"".concat(120*v["a"].ratio,"px"),backgroundColor:"#FF7222",borderRadius:"".concat(36*v["a"].ratio,"px"),height:"".concat(38*v["a"].ratio,"px"),lineHeight:"".concat(38*v["a"].ratio,"px"),color:"white",fontSize:"".concat(14*v["a"].ratio,"px")},onClick:O,children:"\u786e\u8ba4"})}),Object(_["jsx"])(I["r"],{style:{width:"50%"},children:Object(_["jsx"])(I["a"],{style:{width:"".concat(120*v["a"].ratio,"px"),backgroundColor:"#A8A8A8",borderRadius:"".concat(36*v["a"].ratio,"px"),height:"".concat(38*v["a"].ratio,"px"),lineHeight:"".concat(38*v["a"].ratio,"px"),color:"white",fontSize:"".concat(14*v["a"].ratio,"px")},onClick:T,children:"\u53d6\u6d88"})})]})]})},M=Object(p["a"])(E),A={navigationStyle:"default",navigationBarBackgroundColor:"#F3F3F3",navigationBarTextStyle:"black",backgroundColor:"#FFFFFF",backgroundTextStyle:"dark",disableScroll:!0,enableShareAppMessage:!1,navigationBarTitleText:"\u5b8c\u5584\u4e2a\u4eba\u4fe1\u606f"};Page(Object(i["createPageConfig"])(M,"components/PersonalInfoSettingComponent",{root:{cn:[]}},A||{}))}},[[278,0,1,2,3]]]);